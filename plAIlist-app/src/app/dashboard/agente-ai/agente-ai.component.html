<div class="chat-container">
  <!-- Header -->
  <div class="chat-header">
    <div class="header-info">
      <div class="ai-avatar">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path>
          <circle cx="8" cy="14" r="2"></circle>
          <circle cx="16" cy="14" r="2"></circle>
        </svg>
      </div>
      <div class="header-text">
        <h2>PlAIlist Assistant</h2>
        <span class="status">Online</span>
      </div>
    </div>
    <button class="btn-clear-chat" (click)="clearChat()" title="Limpiar chat">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 6h18"></path>
        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
      </svg>
    </button>
  </div>

  <!-- API Key Section -->
  <div class="api-key-section">
    <input 
      type="password" 
      [(ngModel)]="apiKey" 
      placeholder="Ingresa tu API Key de Google Gemini"
      class="api-key-input">
    <button class="btn-save-key" (click)="saveApiKey()">Guardar</button>
  </div>

  <!-- Messages Container -->
  <div class="chat-messages" #chatContainer>
    @for (message of messages; track message.timestamp) {
      <div class="message" [class.user-message]="message.role === 'user'" [class.assistant-message]="message.role === 'assistant'">
        <div class="message-avatar">
          @if (message.role === 'user') {
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path>
              <circle cx="8" cy="14" r="2"></circle>
              <circle cx="16" cy="14" r="2"></circle>
            </svg>
          }
        </div>
        <div class="message-content">
          <div class="message-text">{{ message.content }}</div>
          <div class="message-time">{{ message.timestamp | date:'HH:mm' }}</div>
        </div>
      </div>
    }

    @if (isLoading) {
      <div class="message assistant-message">
        <div class="message-avatar">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path>
            <circle cx="8" cy="14" r="2"></circle>
            <circle cx="16" cy="14" r="2"></circle>
          </svg>
        </div>
        <div class="message-content">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Input Section -->
  <div class="chat-input-container">
    <div class="input-wrapper">
      <textarea 
        [(ngModel)]="userInput" 
        (keydown.enter)="sendMessage(); $event.preventDefault()"
        placeholder="Escribe tu mensaje..."
        rows="1"
        class="chat-input"
        [disabled]="isLoading">
      </textarea>
      <button 
        class="btn-send" 
        (click)="sendMessage()"
        [disabled]="!userInput.trim() || isLoading">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
    <p class="input-hint">Presiona Enter para enviar, Shift+Enter para nueva lÃ­nea</p>
  </div>
</div>
